# LearnFlow â€“ Master Implementation Checklist

> â€**××˜×¨×”**: ××¡××š ×‘×§×¨×” ×™×—×™×“â€¯â€”â€ ×œ×¢×‘×•×¨ ×¡×¢×™×£â€‘×¡×¢×™×£ ×‘×–××Ÿ ×¤×™×ª×•×—, ×œ×¡××Ÿ âœ”ï¸, ×•×œ×•×•×“× ×©×”×§×•×“ × ×©××¨ ×ª×•×× ××¨×›×™×˜×§×˜×•×¨×”.  
> â€**×©×™××•×©**: ×¡××Ÿ `[x]` ×›××©×¨ ×”×©×œ××ª; ××œ ×ª×©× ×” × ×•×¡×—, ×¨×§ ××ª ×”Ö¾checkbox.

---
## 0. Repo / Branch
- [ ] `main` × ×§×™, ×¤×™×ª×•×— ×‘Ö¾`dev` â†’ PR ××œ `main`
- [ ] CI ×¨×¥ ××•×˜×•××˜×™×ª ×¢×œ PR

---
## 1. Secrets & Env
| âœ“ | ×¤×¢×•×œ×” |
|---|-------|
| [ ] | `.env` ××›×™×œ VITE_FB_* ××œ××™× |
| [ ] | GEMINI_KEY × ×•×¡×£ ×œâ€‘`firebase secrets` |
| [ ] | `.env` ×‘â€‘`.gitignore` |

---
## 2. Folder Structure (×œ× ×©×•× ×”)
```
public/ â€¦
src/manifest.ts
src/background/*
src/content/*
src/offscreen/*
src/ui/*
src/shared/*
src/indexdb/*
functions/*
```
- [ ] ××™×Ÿ ×§×‘×¦×™× ×—×™×¦×•× ×™×™× ×œ××‘× ×” ×–×”

---
## 3. Background Layer
- [ ] `src/background/firebase.ts` â€“ Singleton init (no duplicate apps)
- [ ] `broadcast.ts` â€“ bus.emit / bus.on ×¤×¢×™×œ×™×
- [ ] `sync.ts` â€“ flushQueue + listeners notes|chats|words

---
## 4. IndexedDB
- [ ] `dexie.ts` ×¡×›×™××” ××“×•×™×§×ª (words, notes, chats, summaries, queue)
- [ ] enqueueWrite ×§×™×™× ×‘×›×œ ×§×¨×™××ª SAVE_* ×‘×ª×•×›×Ÿ/UI

---
## 5. Content Scripts
| âœ“ | ×§×•×‘×¥ | ×‘×“×™×§×” |
|---|-------|--------|
| [ ] | `floatingUI.ts` | ×›×¤×ª×•×¨×™× ×¦×¤×™× ××•×¦×’×™× ×‘×“×£ ×™×•×˜×™×•×‘ ×•×›×œ ××ª×¨ Video |
| [ ] | `youtubeCaptionDetector.ts` | Tooltip 3s, click â‡’ translate+queue |
| [ ] | `genericCaptionDetector.ts` | ×¢×•×‘×“ ×¢× `<video><track>` |
| [ ] | `detectorFactory.ts` | ××—×œ×™×£ × ×›×•×Ÿ ×‘×™×Ÿ YT/Generic |

---
## 6. Offscreen
- [ ] `gemini.ts` ××§×‘×œ `ASK_GEMINI`, ××—×–×™×¨ ×ª×©×•×‘×”
- [ ] `aiSummarize.ts` ××—×–×™×¨ summary+terms+citation

---
## 7. Cloud Functions (deploy `europe-west1`)
| âœ“ | Name | Trigger/Type |
|---|------|-------------|
| [ ] | `geminiChat` | callable â€“ chat |
| [ ] | `aiSummarize` | callable â€“ summary |
| [ ] | `translateWord`| callable â€“ word |
| [ ] | `onWordWrite`  | Firestore trigger â€“ stats |

---
## 8. UI Components
| âœ“ | Path | Must show |
|---|------|-----------|
| [ ] | `ui/popup/App.tsx` | ×¨×©×™××ª ××™×œ×™×, streak âœ”ï¸ |
| [ ] | `ui/chat/ChatRoot.tsx` | scroll & send âœ”ï¸ |
| [ ] | `ui/notes/NotesRoot.tsx` | add note Enter âœ”ï¸ |
| [ ] | `ui/summary/SummaryRoot.tsx` | bullet list + term cards âœ”ï¸ |
| [ ] | `ui/games/FlashCards.tsx` | next card âœ”ï¸ |

---
## 9. Shared Hooks/Utils
- [ ] `useVocabulary` ××§×¨×™× Dexie liveQuery
- [ ] `useChat.send` â‡’ runtime ASK_GEMINI + adds bot reply
- [ ] `useSummary.exportMd` ×™×•×¦×¨ Blob ×•â€‘download
- [ ] `translateWord` ×§×•×¨× callable `translateWord`

---
## 10. Styles
- [ ] `tailwind.config.ts` ×‘×ª×™×§×™×™×ª ×¨×•×˜
- [ ] `src/styles/tailwind.css` ××•×˜××¢ ×‘× ×§×•×“×ª ×”×›× ×™×¡×” Vite (`import "@/styles/tailwind.css"`)
- [ ] ×× ×™××¦×™×•×ª fade / slide ×¤×•×¢×œ×•×ª

---
## 11. Firebase Console
- [ ] Auth (Google) ×¤×¢×™×œ
- [ ] Firestore rules ×¤×•×¨×¡××•
- [ ] Storage rules ×¤×•×¨×¡××•

---
## 12. CI / GitHub Actions
- [ ] secrets: `FIREBASE_TOKEN`, `CWS_*` ×©×œ××™×
- [ ] Workflow ×¢×•×‘×¨ lint+test+build
- [ ] Functions deploy ××•×˜×•××˜×™ (log âœ…)

---
## 13. Tests
- [ ] `pnpm vitest` ×¢×•×‘×¨
- [ ] E2E (Playwright) ×™×¨×•×§ (××•×¤×¦×™×•× ×œ×™)

---
## 14. Assets CWS
- [ ] icons PNG 16/32/48/128
- [ ] screenshot 1280Ã—800
- [ ] promo video â‰¤30s

---
## 15. README & Privacy
- [ ] README ×¢× ×”×•×¨××•×ª dev/build
- [ ] privacy.html ××•×¢×œ×” (GitHub Pages)

---
## 16. QA Manual
| âœ“ | ×‘×“×™×§×” |
|---|-------|
| [ ] | ×™×•×˜×™×•×‘: ×œ×—×™×¦×” ×¢×œ ××™×œ×” â†’ Tooltip + × ×©××¨ ×‘â€‘popup |
| [ ] | html5 video ×‘××ª×¨ ××—×¨ âœ”ï¸ |
| [ ] | Offline: ××™×œ×” ×‘×ª×•×¨ â†’ ×—×•×–×¨ ××•× ×œ×™×™×Ÿ â†’ Sync âœ”ï¸ |
| [ ] | Gemini Chat ×¢×•× ×” |
| [ ] | Summary ×›×¤×ª×•×¨ ğŸ“š ××•×¤×™×¢ ×¨×§ ×›×©â€‘duration >10min |

---
## 17. RELEASE
- [ ] `pnpm build` â†’ dist.zip =~< 8â€¯MB
- [ ] Git tag `vX.Y.Z`
- [ ] GitHub Action ××¢×œ×” CWS draft âœ”ï¸
- [ ] ×œ×—×¥ "Submit for review"

> ×©××•×¨ ××¡××š ×–×” ××¢×•×“×›×Ÿ â€“ ×”×•× ×”×•×¤×š ×œ××§×•×¨ ×”×××ª ×œ×¤× ×™ ×›×œ Merge.

public/
  â”œâ”€ icons/16.png 48.png 128.png
  â””â”€ offscreen/gemini.html  (stub: basic HTML linking offscreen/gemini.ts)

src/
  manifest.ts                 (typed manifest)

  background/
    index.ts                  (SW root)
    firebase.ts               (Singleton init)
    sync.ts                   (IDBâ‡„FS sync)
    broadcast.ts              (BroadcastChannel helper)

  content/
    index.ts                  (entry â€“ picks detector & floatingUI)
    detectorFactory.ts        (choose YT/Generic)
    youtubeCaptionDetector.ts
    genericCaptionDetector.ts
    floatingUI.ts
    domUtils.ts               (helpers)

  offscreen/
    gemini.ts                 (chat/notes callable)
    aiSummarize.ts            (summary callable)

  ui/
    popup/
      App.tsx
      index.tsx
    options/
      App.tsx
    games/
      FlashCards.tsx
      Memory.tsx
      index.tsx
    chat/
      ChatRoot.tsx
      MessageItem.tsx
    notes/
      NotesRoot.tsx
      NoteRow.tsx
    summary/
      SummaryRoot.tsx
      TermCard.tsx
      ExportButtons.tsx

  shared/
    types/
      word.ts note.ts chat.ts summary.ts
    hooks/
      useAuth.ts useVocabulary.ts useChat.ts useNotes.ts useSummary.ts
    utils/
      translate.ts langDetect.ts citation.ts
    constants.ts

  styles/
    tailwind.css popup.css

  indexdb/
    dexie.ts                  (tables + queue)

functions/
  geminiChat.ts aiSummarize.ts translateWord.ts firestoreTriggers.ts index.ts

tests/
  youtubeDetector.test.ts genericDetector.test.ts translate.test.ts

.github/workflows/ci.yml
firebase.json
vite.config.ts
tsconfig.json
package.json




